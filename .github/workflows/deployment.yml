name: Deployment

on:
  push:
    branches: [ master ]
    paths:
      - "_assets/**/*"
      - "**/*.md"
      - "**/*.html"
      - "webpack.mix.js"
      - "package.json"
      - "_config.yml"
      - "mix-manifest.json"

jobs:
  build:
    runs-on: ubuntu-latest
    steps:
      - uses: actions/checkout@v2
      - name: NPM install and run production
        shell: bash
        run: |
          npm ci
          npm run production
      - name: Copy files to the deployment folder
        shell: bash
        run: cp ./mix-manifest.json _data/mix-manifest.json
      - name: Check git status
        shell: bash
        run: git status --porcelain
      - name: Add and commit new files
        shell: bash
        run: |
          git config user.name github-actions
          git config user.email github-actions@github.com
          git add .
          git commit -m "Deployment"
          git push origin +master:live